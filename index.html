<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GradeBook ‚Äî –ü—Ä–µ–¥–º–µ—Ç—ã</title>

<style>
:root{
  --bg:#eef2ff;
  --card:#ffffff;
  --accent:#4f46e5;
  --accent2:#6366f1;
  --text:#111827;
  --danger:#ef4444;
  --success:#10b981;
  --shadow:0 10px 30px rgba(0,0,0,0.08);
  --hover:#f4f4ff;
  --border:#e5e7eb;
}

*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

html, body{
  height: 100%;
  font-family:'Inter', sans-serif;
  background:var(--bg);
  color:var(--text);
  overflow: hidden;
}

.container{
  height: 100vh;
  display: flex;
  flex-direction: column;
  padding: 20px;
  max-width: none;
  margin: 0;
}

.card{
  flex: 1;
  background:var(--card);
  border-radius:16px;
  box-shadow:var(--shadow);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

h1{
  text-align:center;
  color:var(--accent);
  font-size:28px;
  margin-bottom:20px;
  font-weight:700;
  padding: 15px 0;
  border-bottom: 1px solid var(--border);
}

.controls{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:center;
  margin-bottom:20px;
  align-items: center;
  padding: 0 15px;
}

input{
  padding:14px 16px;
  border-radius:12px;
  border:2px solid var(--border);
  min-width:240px;
  font-size:16px;
  transition: all 0.3s ease;
  background-color:white;
}

input:focus{
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.2);
}

button{
  padding:14px 22px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
  transition: all 0.3s ease;
  font-size:16px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap:8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}

button:active {
  transform: translateY(0);
}

button.primary{
  background:var(--accent);
  color:white;
}

button.secondary{
  border:2px solid var(--accent);
  background:white;
  color:var(--accent);
}

button.danger{
  background:var(--danger);
  color:white;
}

button.success{
  background:var(--success);
  color:white;
}

/* TABLE */
.table-wrap{
  flex: 1;
  overflow: auto;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  margin-top: 10px;
  position: relative;
}

table{
  width:100%;
  border-collapse:collapse;
  min-width:900px;
  background: white;
  table-layout: fixed;
}

thead th{
  background:linear-gradient(135deg, var(--accent2), var(--accent));
  color:white;
  padding:16px 12px;
  text-align:center;
  position:sticky;
  top:0;
  z-index:3;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
  font-size: 16px;
}

td, th{
  border-bottom:1px solid var(--border);
  padding:14px 10px;
  text-align:center;
  font-size:15px;
  word-wrap: break-word;
  word-break: break-all;
}

tbody tr:last-child td {
  border-bottom: none;
}

tbody tr{
  transition:all 0.3s ease;
}
tbody tr:hover{
  background:var(--hover);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫ */
.grade-cell {
  padding: 10px 12px;
  border-radius: 6px;
  background-color: #f9fafb;
  border: 1px solid var(--border);
  font-weight: 500;
  min-height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 60px;
  font-size: 15px;
}

.grade-cell:hover {
  background-color: #e0e7ff;
  border-color: var(--accent);
}

.grade-cell.selected {
  background-color: #e0e7ff;
  border-color: var(--accent);
  font-weight: 600;
}

.grade-cell.empty {
  color: #9ca3af;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ —Å–µ–ª–µ–∫—Ç–∞ */
.grade-popup {
  position: absolute;
  z-index: 1000;
  background: white;
  border: 2px solid var(--accent);
  border-radius: 8px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  padding: 10px;
  display: none;
  min-width: 80px;
}

.grade-popup select {
  padding: 8px 10px;
  border-radius: 6px;
  border: 1px solid var(--border);
  font-size: 14px;
  width: 100%;
}

.deleteBtn{
  background:var(--danger);
  color:white;
  border-radius:8px;
  padding:10px 14px;
  font-size:14px;
  border: none;
  cursor: pointer;
  font-weight:600;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.deleteBtn:hover{
  background:#c53030;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

/* EMPTY STATE */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #6b7280;
}

.empty-state p {
  margin-top: 15px;
  font-size: 18px;
}

.empty-state i {
  font-size: 64px;
  margin-bottom: 20px;
  display: block;
  color: #9ca3af;
}

/* PRINT/SNAPSHOT STYLES */
@media print {
  body {
    background: white;
    padding: 0;
  }
  .card {
    box-shadow: none;
    border-radius: 0;
    margin: 0;
  }
  .controls {
    display: none;
  }
  .table-wrap {
    box-shadow: none;
    margin: 0;
  }
}

/* RESPONSIVE */
@media(max-width:768px){
  .controls {
    flex-direction: column;
    align-items: stretch;
  }
  
  input{
    min-width:100%;
  }
  
  button {
    width: 100%;
  }
  
  h1 {
    font-size: 24px;
    padding: 12px 0;
  }
  
  td, th {
    padding: 10px 6px;
    font-size: 14px;
  }
  
  .grade-cell {
    padding: 8px 10px;
    min-height: 32px;
    min-width: 50px;
    font-size: 14px;
  }
}

@media(max-width:480px){
  body {
    padding: 0;
  }
  
  .container {
    padding: 10px;
  }
  
  .card {
    padding: 0;
  }
  
  h1 {
    font-size: 20px;
  }
  
  .grade-cell {
    padding: 6px 8px;
    min-height: 28px;
    min-width: 45px;
    font-size: 13px;
  }
  
  .controls {
    padding: 0 10px;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <h1>üìò GradeBook ‚Äî –ü—Ä–µ–¥–º–µ—Ç—ã</h1>

    <div class="controls">
      <input type="text" id="studentName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞">
      <button class="primary" onclick="addStudent()">
        <span>‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞
      </button>
      <button class="secondary" onclick="takeScreenshot()">
        <span>üì∏</span> –°–∫–∞—á–∞—Ç—å –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      </button>
      <button class="danger" onclick="clearAll()">
        <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
      </button>
    </div>

    <div id="screenshotArea" class="table-wrap">
      <table>
        <thead>
          <tr id="subjectsRow"></tr>
        </thead>
        <tbody id="studentsTable"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- –í—Å–ø–ª—ã–≤–∞—é—â–∏–π —Å–µ–ª–µ–∫—Ç -->
<div id="gradePopup" class="grade-popup">
  <select id="gradeSelect"></select>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
// ---------- SUBJECTS ----------
const subjects = [
 "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞","–§–∏–∑—Ä–∞","–ò—Å—Ç–æ—Ä–∏—è","–ö—ã—Ä–≥—ã–∑—Å–∫–∏–π","–ß–ò–û",
 "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞","–†—É—Å—Å–∫–∏–π","–•–∏–º–∏—è","–§–∏–∑–∏–∫–∞","–ê–Ω–≥–ª–∏–π—Å–∫–∏–π",
 "–†–µ–ª–∏–≥–∏—è","–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞","–ì–µ–æ–≥—Ä–∞—Ñ–∏—è","–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è",
 "–ì–µ–æ–º–µ—Ç—Ä–∏—è","–ë–∏–æ–ª–æ–≥–∏—è","–ê–¥–∞–±–∏—è—Ç"
];

// ---------- GRADES ----------
const grades = ["", "–Ω/–∞", "2", "3", "4", "5"];

let students = JSON.parse(localStorage.getItem("students_subjects")) || [];

function save(){
  localStorage.setItem("students_subjects", JSON.stringify(students));
}

// ---------- ADD STUDENT ----------
function addStudent(){
  const name = document.getElementById("studentName").value.trim();
  if(!name) {
    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞!");
    return;
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
  if(students.some(s => s.name.toLowerCase() === name.toLowerCase())) {
    alert("–£—á–µ–Ω–∏–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!");
    return;
  }

  const student = { name };
  subjects.forEach(sub => student[sub] = "");

  students.push(student);
  save();
  render();
  document.getElementById("studentName").value = "";
  document.getElementById("studentName").focus();
}

// ---------- DELETE ----------
function deleteStudent(i){
  if(!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞?")) return;
  students.splice(i,1);
  save();
  render();
}

// ---------- UPDATE ----------
function updateGrade(studentIndex, subject, value){
  students[studentIndex][subject] = value;
  save();
  render(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
}

// ---------- SHOW GRADE SELECT ----------
function showGradeSelect(cell, studentIndex, subject) {
  const popup = document.getElementById('gradePopup');
  const select = document.getElementById('gradeSelect');
  
  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç
  select.innerHTML = '';
  grades.forEach(grade => {
    const option = document.createElement('option');
    option.value = grade;
    option.textContent = grade || '‚Äî';
    if (students[studentIndex][subject] === grade) {
      option.selected = true;
    }
    select.appendChild(option);
  });
  
  // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
  const rect = cell.getBoundingClientRect();
  popup.style.top = rect.bottom + window.scrollY + 5 + 'px';
  popup.style.left = rect.left + window.scrollX + 'px';
  popup.style.display = 'block';
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  select.onchange = function() {
    updateGrade(studentIndex, subject, this.value);
    popup.style.display = 'none';
  };
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
  setTimeout(() => {
    document.addEventListener('click', function closePopup(e) {
      if (!popup.contains(e.target) && !cell.contains(e.target)) {
        popup.style.display = 'none';
        document.removeEventListener('click', closePopup);
      }
    });
  }, 10);
}

// ---------- RENDER ----------
function render(){
  // subject header row
  document.getElementById("subjectsRow").innerHTML =
    `<th>–ò–º—è</th>` +
    subjects.map(s => `<th>${s}</th>`).join("") +
    `<th>–î–µ–π—Å—Ç–≤–∏–µ</th>`;

  const tbody = document.getElementById("studentsTable");
  
  if (students.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="${subjects.length + 2}" class="empty-state">
          <p>–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤ –≤ –∂—É—Ä–Ω–∞–ª–µ</p>
          <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</p>
        </td>
      </tr>
    `;
    return;
  }

  tbody.innerHTML = "";

  students.forEach((st, i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${st.name}</td>
      ${subjects.map(sub => {
        const grade = st[sub];
        const isEmpty = !grade;
        const isSelected = !!grade;
        return `
          <td>
            <div class="grade-cell ${isEmpty ? 'empty' : ''} ${isSelected ? 'selected' : ''}" 
                 onclick="showGradeSelect(this, ${i}, '${sub.replace(/'/g, "\\'")}')">
              ${grade || '‚Äî'}
            </div>
          </td>
        `;
      }).join("")}
      <td><button class="deleteBtn" onclick="deleteStudent(${i})">–£–¥–∞–ª–∏—Ç—å</button></td>
    `;
    tbody.appendChild(tr);
  });
}

// ---------- SCREENSHOT ----------
function takeScreenshot(){
  const screenshotArea = document.getElementById("screenshotArea");
  
  // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  html2canvas(screenshotArea, {
    backgroundColor: '#ffffff',
    scale: 2,
    useCORS: true,
    allowTaint: true,
    logging: false,
    width: screenshotArea.scrollWidth,
    height: screenshotArea.scrollHeight,
    scrollX: 0,
    scrollY: 0,
    dpi: 192 // –í—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ø–µ—á–∞—Ç–∏
  }).then(canvas=>{
    const a = document.createElement("a");
    a.href = canvas.toDataURL("image/png", 1.0);
    a.download = `gradebook_${new Date().toISOString().slice(0, 10)}.png`;
    a.click();
  });
}

// ---------- CLEAR ----------
function clearAll(){
  if(!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö —É—á–µ–Ω–∏–∫–æ–≤? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")) return;
  students = [];
  save();
  render();
}

// ---------- INIT ----------
document.getElementById("studentName").addEventListener("keypress", function(e) {
  if(e.key === "Enter") {
    addStudent();
  }
});

// –°–∫—Ä—ã—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–∏–π —Å–µ–ª–µ–∫—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.getElementById('gradePopup').style.display = 'none';

render();
</script>

</body>
</html>
